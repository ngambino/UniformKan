\documentclass[reqno,10pt,a4paper,oneside]{amsart}

\usepackage{uniform-kan-prelude}

\title{Remarks on Algebraic Weak Factorization Systems}

\begin{document}

\begin{abstract}
We collect some general remarks concerning algebraic weak factorization systems in view of later applications.
\end{abstract}

\maketitle

\tableofcontents

Recall the notion of \emph{algebraic weak factorization system} from~\cite{garner:small-object-argument} (there called \emph{natural weak factorization system}).

\section{Identifying Isomorphic Algebraic Weak Factorization Systems}

The motivation for this section is \cref{monos-into-representables,decidable-monos-into-representables}, providing a partial justification for choosing (decidable) monomorphisms into representables (and cartesian squares as morphisms) as generating left category for algebraic fibrations in simplicial sets.

\subsection{An Easy Criterion}

Fix a cocomplete category $\cat{E}$. 
We prove an easy sufficient criterion for when a category over $\cat{E}^{\to}$ has the same free algebraic weak factorization system as a full subcategory of it.

\begin{proposition}
\label{criterion-for-cats-generating-same-awfs}
Consider a functor of categories over $\cat{E}^{\to}$ as follows:
\[
\xymatrix{
  \cat{C}
  \ar[rr]^{F}
  \ar[dr]_{I}
&&
  \cat{D}
  \ar[dl]^{J}
\\&
  \cat{E}^{\to}
}
\]
Suppose that $F$ is fully faithful and that $J$ is the left Kan extension of $I$ along $F$.
Then $I$ admits a free algebraic weak factorization system precisely if $J$ does, and the morphism between them induced by $F$ is an isomorphism.
\end{proposition}

\begin{proof}
Let $U$ denote the functor from algebraic weak factorization systems for $\cat{E}$ to categories over $\cat{E}^{\to}$ mapping $(L, R)$ to $\Coalg(L)$.
Recall that $(L, R)$ is free on $A : \CAT/\cat{E}^{\to}$ precisely if we have a map $\eta : A \to \Coalg(L)$ such that $((L, R), \eta)$ is initial in $A \downarrow U$.

Composition with $F$ induces a faithful functor from $J \downarrow U$ to $I \downarrow U$.
Let us show that this is an isomorphism, hence relates initial objects.
It will be enough to verify that for an algebraic weak factorization system $(L, R)$, any map $P : \cat{C} \to \Coalg(L)$ over $\cat{E}^{\to}$ factors uniquely through $F$ as indicated below:
\[
\xymatrix{
  \cat{C}
  \ar[rr]^{P}
  \ar[dr]^{F}
  \ar[ddr]_{I}
&&
  \Coalg(L)
  \ar[ddl]
\\&
  \cat{D}
  \ar@{.>}[ur]^{\exists !}
  \ar[d]^(0.3){J}
\\&
  \cat{E}^{\to}
}
\]
This follows by applying \cref{ugly-outsourced-lemma} below.
For this, note that $\cat{E}^{\to}$ and $\Coalg(L)$ are cocomplete with $\cat{E}$ and that the functor $\Coalg(L) \to \cat{E}^{\to}$ is strictly comonadic, hence cocontinuous and an amnestic isofibration.
\end{proof}

\begin{lemma}
\label{ugly-outsourced-lemma}
Consider categories and functors strictly commuting as indicated by solid lines below:
\[
\xymatrix{
  \cat{C}
  \ar[rr]^{P}
  \ar[dr]^{F}
%  \ar[ddr]_{I}
&&
  \cat{X}
  \ar[ddl]^{K}
\\&
  \cat{D}
  \ar@{.>}[ur]^{H}
  \ar[d]^(0.3){J}
\\&
  \cat{E}
}
\]
Assume that
\begin{itemize}
\item
$F$ is fully faithful,
\item
$J$ is the left Kan extension of some functor $I : \cat{C} \to \cat{E}$ along $F$,
\item
$\cat{X}$ and $\cat{E}$ are cocomplete and $K : \cat{X} \to \cat{E}$ creates colimits,
\item
$K$ is an amnestic isofibration.%
\footnote{
  A functor is \emph{amnestic} if any isomorphism mapping to an identity is itself an identity.
  An amnestic isofibration is characterized by unique lifts of isomorphisms given a lift of either its domain or codomain.
  This non-invariant assumption is necessary here because we are working with strict equality of functors.
}
\end{itemize}
Then there is a unique functor $H$ strictly cohering as indicated by the dotted line.
\end{lemma}

\begin{proof}
First of all, observe that given a diagram in $\cat{X}$ and a colimiting cone for it in $\cat{E}$, there is a strictly unique lift of this cone through the amnestic isofibration $K$ (lifting up to isomorphism uses cocompleteness and creation of colimits, existence of a strict lift uses the isofibration, and strict uniqueness uses amnesticity).

We define the desired functor $H : \cat{D} \to \cat{X}$ as follows.
All of the following will be functorial in $Y : \cat{D}$.
We consider the canonical cocone $Z$ of the diagram $F \downarrow Y \to \cat{C} \to \cat{D}$ with cotip $Y$.
Since $J = \Lan_F I$, the cocone $JZ$ is colimiting in $\cat{E}$.
By the constraint $HF = P$, the diagram part of $HZ$ needs to be $F \downarrow Y \to \cat{C} \to \cat{X}$.
By the constraint $KH = J$, the image of $HZ$ under $K$ needs to be the colimiting cocone $JZ$.
This determines $HZ$ uniquely according to the first paragraph, hence also its cotip $H(Y)$.

Note that for $Y = F(X)$ with $X : \cat{C}$, there is a canonical cocone over $F \downarrow F(X) \to \cat{C} \to \cat{X}$ with cotip $P(X)$ using full faithfulness of $F$.
This cocone satisfies the constraints of the previous paragraph (using $KP = JF$ for the second one), hence we have $HF = P$.
The other constraint $KH = J$ holds by construction.
\end{proof}

\subsection{Application to Presheaf Categories}

We now consider presheafs on a category $\cat{B}$.
Our intention is to apply \cref{criterion-for-cats-generating-same-awfs} to full subcategories of $(\Set^{\cat{B}})_{\cart}^{\to}$, the arrow category of presheafs on $\cat{B}$ with cartesian squares as morphisms:

\begin{proposition}
\label{awfs-on-arrows-into-representables}
Let $\cat{J}$ be a full subcategory of $(\Set^{\cat{B}})_{\cart}^{\to}$ closed under base change to representables.
Let $\cat{I}$ denote its restriction to arrows into representables.
\[
\xymatrix{
  \cat{I}
  \ar[rr]
  \ar[dr]
&&
  \cat{J}
  \ar[dl]
\\&
  (\Set^{\cat{B}})^{\to}
}
\]
Suppose that $\cat{I}$ is small, so that it generates an algebraic weak factorization system $(L, R)$ (algebraically) free on $\cat{I}$.
Then $(L, R)$ is also free on $\cat{J}$, with the universal maps related by $\cat{I} \to \cat{J}$.
It $\cat{J}$ is small, then $(L, R)$ will be algebraically free on $\cat{J}$.%
\footnote{
  Not being able to always show $(L, R)$ algebraically free on $\cat{J}$ is currently the drawback of arguing from the left instead of the right.
  The left side relates better to freeness, while the right side related better to algebraic freeness.
  But arguing from the right always starts with quantifying over a generic algebra never playing any role in the argument beside being lifted against from the left --- the real reasoning takes place entirely on the left in the form of colimit closure properties.
  So the left approach followed here is preferable from an asthetic point to the right approach previously written out.
  Algebraic freeness for non-small categories, if relevant, should follow as a technical corollary by set theoretic reasoning (Garner would know a nice way).
}
\end{proposition}

\begin{proof}
Garner's small object argument~\cite{garner:small-object-argument} generates an algebraic weak factorization system $(L, R)$ algebraically free on $\cat{I}$. 
It is also shown in~\cite{garner:small-object-argument} that algebraic freeness implies freeness.
For the first claim, we apply \cref{criterion-for-cats-generating-same-awfs}, offloading its proof obligations to the below \cref{left-kan-extension-of-representables}.
Finally, if $\cat{J}$ is also small, it will generate an algebraically free (hence free) algebraic weak factorization system itself.
By universality of freeness, it is isomorphic to $(L, R)$, which henceforth must be algebraically free on $\cat{J}$.
\end{proof}

\begin{lemma}
\label{left-kan-extension-of-representables}
In the situation of \cref{awfs-on-arrows-into-representables}, the inclusion $\cat{J} \to (\Set^{\cat{B}})^{\to}$ is the left Kan extension of $\cat{I} \to (\Set^{\cat{B}})^{\to}$ along $\cat{I} \to \cat{J}$.
\end{lemma}

\begin{question}
There should be an abstract argument here cleverly combining the codomain fibration and the corresponding left Kan extension claim for the codomain part
\[
\xymatrix{
  \cat{B}
  \ar[rr]^{y}
  \ar[dr]_{y}
&&
  \Set^{\cat{B}}
  \ar[dl]^{\id}
\\&
  \Set^{\cat{B}}
}
\]
which holds by the co-Yoneda lemma.
How does it go?
\end{question}

\begin{proof}
Since $(\Set^{\cat{B}})^{\to}$ is cocomplete, we can use the colimit formula for left Kan extensions to verify the claim.
All of the following will be functorial in an object $f : X \to Y$ of $\cat{J}$.
We consider the diagram indexed by cartesian squares
\[
\xymatrix{
  U
  \ar[r]
  \ar[d]_{h}
  \pullback{dr}
&
  X
  \ar[d]^{f}
\\
  \hom(\arghole, M)
  \ar[r]
&
  Y
}
\]
with $h : \cat{I}$ and valued $h$.
Our goal is to show that its colimit in $(\Set^{\cat{B}})^{\to}$ is $f$.
Using the assumption that $\cat{J}$ is closed under base change to representables, this is equivalently the diagram indexed by representables $s : \hom(\arghole, M) \to Y$ and valued $s^* i$.
Generalized to this level, the statement $\colim_{s : \hom(\arghole, M) \to Y} s^* f \simeq f$ holds since base change commutes with colimits and $\colim_{s : \hom(\arghole, M) \to Y} \hom(\arghole, M) \simeq Y$.
\end{proof}

\subsection{Application to Algebraic Cofibrations in Simplicial Sets}

The class of decidable monomorphisms is closed under base change.
We thus obtain as immediate consequences of \cref{awfs-on-arrows-into-representables}:

\begin{corollary}
\label{monos-into-representables}
The algebraically free algebraic weak factorization system generated by the full subcategory
\[\cat{I} = \braces{A \to \Delta^n\ \text{\normalfont{mono}}}\]
of $\SSetCart$ is also (algebraically) free on any other (small) full subcategory of monomorphisms containing $\cat{I}$.
\end{corollary}

\begin{corollary}
\label{decidable-monos-into-representables}
The algebraically free algebraic weak factorization system generated by the full subcategory
\[\cat{I}' = \braces{A \to \Delta^n\ \text{\normalfont{decidable mono}}}\]
of $\SSetCart$ is also (algebraically) free on any other (small) full subcategory of decidable monomorphisms containing $\cat{I}'$.
\end{corollary}

\section{Base Change for Algebras in an Algebraic Weak Factorization System}

\subsection{Preservation Results for Algebra Category Formation}

Consider a monad $S$ on a category $\cat{C}$ and a monad $T$ on a category $\cat{E}$ such that $T$ lies over $S$ with respect to a functor $P : \cat{E} \to \cat{C}$.
This gives rise to a functor $Q : \Alg(T) \to \Alg(S)$ strictly commuting as follows:
\begin{equation}
\label{relative-monad-situation}
\begin{gathered}
\xymatrix{
  \Alg(T)
  \ar[r]^-{U_T}
  \ar[d]^{Q}
&
  \cat{E}
  \ar[d]^{P}
\\
  \Alg(S)
  \ar[r]^-{U_S}
&
  \cat{C}
}
\end{gathered}
\end{equation}

\begin{lemma}
\label{Alg-preserves-cartesian-fib}
If $P$ is a cartesian fibration, then $Q$ is a cartesian fibration.
The top map $U_T$ in~\eqref{relative-monad-situation} creates cartesian morphisms.
\end{lemma}

\begin{remark}
This is entirely analogous to a certain lemma about inserter formation preserving cartesian fibrations from an unrelated write-up.
In fact, a corresponding generalization to quasi-categories in terms of almost-marked simplicial sets applies, which would also makes the proof far less redundant.
\end{remark}

\begin{proof}
Let us first show that $U_T$ reflects cartesian morphisms.
Consider the below situation of solid lines:
\[
\xymatrix{
  (X, \rho)
  \ar@{.>}[dr]_{f}
  \ar[drr]^{g}
\\&
  (Y, \sigma)
  \ar[r]_{h}
&
  (Z, \tau)
&
  \Alg(T)
  \ar[dd]^{Q}
\\
  (A, \alpha)
  \ar[dr]_{a}
  \ar[drr]^{b}
\\&
  (B, \beta)
  \ar[r]_{c}
&
  (C, \gamma)
&
  \Alg(S)
}
\]
With $h$ assumed $P$-cartesian, our goal is show unique existence of $f$ as indicated by the dotted line.
By assumption, we get a unique candidate $f$ after applying $U_S$ and $U_T$ to the situation.
We only need to verify that $f$ is an algebra map, \ie that the maps $f \cc \rho$ and $\sigma \cc T(f)$ over $a \cc \alpha = \beta \cc S(a)$ are identical.
Since $h$ is $P$-cartesian, this reduces to showing $h \cc f \cc \rho$ and $h \cc \sigma \cc T(f)$ identical, but this follows from $g$ and $h$ being algebra maps.

Let us now show that $Q$ has cartesian lifts.
Consider the below situation of solid lines:
\[
\xymatrix{
  (Y, \sigma)
  \ar@{.>}[r]_{\text{cart}}^{h}
&
  (Z, \tau)
&
  \Alg(T)
  \ar[d]^{Q}
\\
  (B, \beta)
  \ar[r]^{c}
&
  (C, \gamma)
&
  \Alg(S)
}
\]
We want to find $(Y, \sigma)$ and $h : (Y, \sigma) \to (Z, \tau)$ cartesian lifting as indicated.
We start be constructing a $P$-cartesian lift $h : Y \to Z$ after applying $U_S$ and $U_T$ to the situation.
Applying the previous paragraph, it remains to construct $\sigma : T(Y) \to Y$ over $\beta$ such that $h \cc \sigma = \tau \cc T(h)$.
But there is a unique such $\sigma$ since $h$ is $P$-cartesian and $c \cc \beta = \gamma \cc S(c)$ in the base $\cat{C}$.
Similary, we can deduce the algebra laws for $\sigma$ from those for $\tau$ by left composing with $h$.

By construction, the chosen cartesian lifts for $Q$ are preserved by $U_T$.
Since every cartesian morphism is suitably isomorphic to such a chosen lift, we deduce $U_T$ preserves cartesian morphisms.
\end{proof}

\begin{lemma}
\label{Alg-preserves-cocartesian-fib}
If $P$ is a cocartesian fibration and $T$ a cocartesian functor over $S$, then $Q$ is a cocartesian fibration.
The top map $U_T$ in~\eqref{relative-monad-situation} creates cocartesian morphisms.
\end{lemma}

\begin{remark}
This is almost dual to \cref{Alg-preserves-cartesian-fib}.
In fact, in the write-up for inserters mentioned earlier, it is exactly dual.
\end{remark}

\begin{proof}
Let us first show that $U_T$ reflects cocartesian morphisms.
Consider the below situation of solid lines:
\[
\xymatrix{
&&
  (Z, \tau)
\\
  (X, \rho)
  \ar[r]_{f}
  \ar[urr]^{g}
&
  (Y, \sigma)
  \ar@{.>}[ur]_{h}
&&
  \Alg(T)
  \ar[dd]^{Q}
\\&&
  (C, \gamma)
\\
  (A, \alpha)
  \ar[r]_{a}
  \ar[urr]^{b}
&
  (B, \beta)
  \ar[ur]_{c}
&&
  \Alg(S)
}
\]
With $f$ assumed $P$-cocartesian, our goal is show unique existence of $h$ as indicated by the dotted line.
By assumption, we get a unique candidate $h$ after applying $U_S$ and $U_T$ to the situation.
We only need to verify that $h$ is an algebra map, \ie that the maps $h \cc \sigma$ and $\tau \cc T(h)$ over $c \cc \beta = \gamma \cc S(c)$ are identical.
By assumption, also $T(f)$ is $P$-cocartesian.
With this, the goal reduces to showing $h \cc \sigma \cc T(f)$ and $\tau \cc T(h) \cc T(f)$ identical, but this follows from $f$ and $g$ being algebra maps.

Let us now show that $Q$ has cocartesian lifts.
Consider the below situation of solid lines:
\[
\xymatrix{
  (X, \rho)
  \ar@{.>}[r]_{\text{cocart}}^{f}
&
  (Y, \sigma)
&
  \Alg(T)
  \ar[d]^{Q}
\\
  (A, \alpha)
  \ar[r]^{a}
&
  (B, \beta)
&
  \Alg(S)
}
\]
We want to find $(Y, \sigma)$ and $f : (X, \rho) \to (Y, \sigma)$ cocartesian lifting as indicated.
We start be constructing a $P$-cocartesian lift $h : X \to Y$ after applying $U_S$ and $U_T$ to the situation.
Applying the previous paragraph, it remains to construct a structure map $\sigma : T(Y) \to Y$ over $\beta$ such that $f \cc \rho = \sigma \cc T(f)$.
But there is a unique such $\sigma$ since $T(f)$ is $P$-cocartesian and $a \cc \alpha = \beta \cc S(a)$ in the base $\cat{C}$.
Similarly, we can deduce the unit and multiplication laws for $\sigma$ from those for $\rho$ by right composing with $f$ and $T^2(f)$, respectively, using that these maps are $P$-cocartesian.

By construction, the chosen cocartesian lifts for $Q$ are preserved by $U_T$.
Since every cocartesian morphism is suitably isomorphic to such a chosen lift, we deduce $U_T$ preserves cocartesian morphisms.
\end{proof}

\begin{lemma}
\label{right-adjoints-in-2-cat-of-monads}
Consider a 1-cell $(L, \phi) : (A, S) \to (B, T)$ in the 2-category $\Mnd(\cat{C})$ of monads on some 2-category $\cat{C}$.
If $L : A \to B$ has a right adjoint $R : B \to A$ and $\phi$ is invertible, then $(L, \phi)$ has a right adjoint in $\Mnd(\cat{C})$.
\end{lemma}

\begin{proof}
This is routine verification.
Let $R : B \to A$ be the right adjoint to $L$.
Since in $\cat{C}$ the 2-cell
\[
\xymatrix{
  A
  \ar[r]^{L}
  \ar[d]_{S}
  \drtwocell<\omit>{\phi}
&
  B
  \ar[d]^{T}
\\
  A
  \ar[r]_{L}
&
  B
}
\]
is invertible, we can look at the mate of its inverse:
\[
\xymatrix{
  A
  \ar[d]_{S}
&
  B
  \ar[l]_{R}
  \ar[d]^{T}
  \dltwocell<\omit>{^\psi}
\\
  A
&
  B
  \ar[l]^{R}
}
\]
Using the calculus of mates, we verify that $(R, \psi) : (B, T) \to (A, S)$ is indeed a 1-cell in $\Mnd(\cat{C})$.

It remains to construct 2-cells $\epsilon : (L, \phi) \cc (R, \psi) \to \Id_{(A, S)}$ and $\eta : \Id_{(B, T)} \to (R, \psi) \cc (L, \phi)$ satisfying the triangle identifies.
Recall that a 2-cell in $\Mnd(\cat{C})$ is simply a 2-cell in $\cat{C}$ between the underlying 1-cells satisfying coherence with respect to the 2-cell parts of source and target.
We simply take the counit and unit 2-cells of the adjunction $L \dashv R$.
The coherence conditions will be tautologically satisfied by how $\psi$ was defined as a mate using the adjunction $L \dashv R$.

Finally, the triangle identities hold because they hold for the underlying adjunction $L \dashv R$, equality of 2-cells in $\Mnd(\cat{C})$ just being equality of the underlying 2-cells.
\end{proof}

\begin{lemma}
\label{Alg-preserves-right-adjoint-to-base-change}
Assume that
\begin{itemize}
\item
$P$ is a cartesian fibration,
\item
$P$ has cocartesian lifts over structure maps of $S$-algebras and $U_T$ preserves these,
\item
the Beck-Chevalley condition holds between the above cartesian and cocartesian lifts,%
\footnote{
  The last two conditions are likely not needed, but it helps with the presentation since it allows us to meld the fiberwise action of $T$ into a monad on the fiber.
  In the corresponding result for inserters, these conditions were not needed.
}
\item
$P$ has right adjoints to base change.
\end{itemize}
Let $d : (A, \alpha) \to (B, \beta)$ be a map of $S$-algebras
\[
\xymatrix{
  S(A)
  \ar[r]^{S(d)}
  \ar[d]^{\alpha}
&
  S(B)
  \ar[d]^{\beta}
\\
  A
  \ar[r]^{d}
&
  B
}
\]
such that $T$ maps cartesian lifts of $d$ to cartesian lifts of $S(d)$.
Then $Q$ has a right adjoint to base change along $d$.
\end{lemma}

\begin{question}
What about Beck-Chevalley for right adjoints to base change in $Q$?
\end{question}

\begin{proof}
Let $\gamma : S(C) \to C$ be an $S$-algebra.
By assumption, we have a cobase change $\gamma_! : P^{-1}(S(C)) \to P^{-1}(C)$.
This can be used to define a monad on $M_{(C, \gamma)}$ on $P^{-1}(C)$ as the following composition:
\[
\xymatrix{
  P^{-1}(C)
  \ar[r]^{T}
&
  P^{-1}(S(C))
  \ar[r]^-{\gamma_!}
&
  P^{-1}(C)
}
\]
Unit and multiplication of $T$ over $S$ carry over to $M_{(C, \gamma)}$ using that $T$ preserves $P$-cocartesian lifts of $S$-algebras.
With this, note that $Q^{-1}(C, \gamma)$ can equivalently be described as algebras over $M_{(C, \gamma)}$.

Returning to the map $d : (A, \alpha) \to (B, \beta)$ of $S$-algebras, note that $d^* : P^{-1}(B) \to P^{-1}(A)$ lifts to a morphism of monads $\phi_d : M_{(B, \beta)} \to M_{(A, \alpha)}$:
\begin{equation}
\label{Alg-preserves-right-adjoint-to-base-change:0}
\begin{gathered}
\xymatrix{
  P^{-1}(A)
  \ar[d]^{T}
&
  P^{-1}(B)
  \ar[l]^{d^*}
  \ar[d]^{T}
  \dltwocell<\omit>{^}
\\
  P^{-1}(S(A))
  \ar[d]^{\alpha_!}
&
  P^{-1}(S(B))
  \ar[l]^{S(d)^*}
  \ar[d]^{\beta_!}
  \dltwocell<\omit>{^}
\\
  P^{-1}(A)
&
  P^{-1}(B)
  \ar[l]^{d^*}
}
\end{gathered}
\end{equation}
We will use \cref{right-adjoints-in-2-cat-of-monads} to show that $\phi_d$ has a right adjoint $\psi_d$ in the 2-category of monads.
By \cref{right-adjoints-in-2-cat-of-monads}, this will be the case if $d^*$ has a right adjoint and the composite 2-cell in~\eqref{Alg-preserves-right-adjoint-to-base-change:0} is invertible.
But $d^*$ has a right adjoint by assumption.
The upper 2-cell in~\eqref{Alg-preserves-right-adjoint-to-base-change:0} is invertible because $T$ preserves $P$-cartesian lifts of $d$.
The lower 2-cell in~\eqref{Alg-preserves-right-adjoint-to-base-change:0} is invertible because of Beck-Chevalley.

Under the identifications $Q^{-1}(A, \alpha) \simeq \Alg(M_{(A, \alpha)})$ and $Q^{-1}(B, \beta) \simeq \Alg(M_{(B, \beta)})$, base change along $d$ in $Q$ corresponds to $\Alg(\phi_d)$.
The desired right adjoint to base change can thus be derived from $\phi_d \dashv \psi_d$ since the 2-functor $\Alg$ preserves adjunctions.
\end{proof}

\begin{corollary}
\label{Alg-preserves-right-adjoint-to-base-change-BC}
In the setting of \cref{Alg-preserves-right-adjoint-to-base-change}, consider a commutative square of $S$-algebras as follows:
\begin{equation}
\label{Alg-preserves-right-adjoint-to-base-change-BC:0}
\begin{gathered}
\xymatrix{
  (A, \alpha)
  \ar[r]^{d}
  \ar[d]^{a}
&
  (B, \beta)
  \ar[d]^{b}
\\
  (A', \alpha')
  \ar[r]^{d'}
&
  (B', \beta')
}
\end{gathered}
\end{equation}
Assume that $T$ preserves cartesianness of lifts of $d$ and $d'$ so that the respective right adjoints $R$ and $R'$ to base change in $Q$ along $d$ and $d'$ exist as per \cref{Alg-preserves-right-adjoint-to-base-change}.
If the right adjoints $d_*$ and $d_*'$ to base change in $P$ satisfy Beck-Chevalley with respect to the square
\[
\xymatrix{
  A
  \ar[r]^{d}
  \ar[d]^{a}
&
  B
  \ar[d]^{b}
\\
  A'
  \ar[r]^{d'}
&
  B'
}
\]
then $R$ and $R'$ satisfy Beck-Chevalley with respect to~\eqref{Alg-preserves-right-adjoint-to-base-change-BC:0} in $Q$.
\end{corollary}

\begin{proof}
We will continue to use the notation and identifications of the proof of \cref{Alg-preserves-right-adjoint-to-base-change}.
Our goal is to show that the mate
\[
\xymatrix{
  \Alg(M_{(A, \alpha)})
  \ar[r]^{\Alg(\psi_d)}
&
  \Alg(M_{(B, \beta)})
\\
  \Alg(M_{(A', \alpha')})
  \ar[r]^{\Alg(\psi_d)}
  \ar[u]^{\Alg(\phi_a)}
  \urtwocell<\omit>{^}
&
  \Alg(M_{(B', \beta')})
  \ar[u]^{\Alg(\phi_b)}
}
\]
is invertible.
By 2-functoriality, this will follow if we can show the mate
\[
\xymatrix{
  M_{(A, \alpha)}
  \ar[r]^{\psi_d}
&
  M_{(B, \beta)}
\\
  M_{(A', \alpha')}
  \ar[r]^{\psi_d}
  \ar[u]^{\phi_a}
  \urtwocell<\omit>{^}
&
  M_{(B', \beta')}
  \ar[u]^{\phi_b}
}
\]
invertible in the 2-category of monads.
But this holds since the underlying natural transformation
\[
\xymatrix{
  P^{-1}(A)
  \ar[r]^{d_*}
&
  P^{-1}(B)
\\
  P^{-1}(A')
  \ar[r]^{d_*}
  \ar[u]^{a^*}
  \urtwocell<\omit>{^}
&
  P^{-1}(B')
  \ar[u]^{b^*}
}
\]
is invertible by the Beck-Chevalley assumption for $P$.
\end{proof}

% An unfinished minimalistic ad-hoc attempt working with base change instead of cobase change
\begin{comment}
A $T$-algebra over $\alpha : S(A) \to A$ consists of $X$ over $A$ and $\rho : T(X) \to X$ over $\alpha$ such that $(X, \rho)$ is a $T$-algebra.
Equivalently, it consists of $X$ over $A$ and $\rho : T(X) \to \alpha^*(X)$ over $S(A)$ such that a modified unit law
\[
\xymatrix{
  X
  \ar[d]^{\mu_{T, X}'}
  \ar@{=}[r]
&
  X
  \ar@{=}[d]
\\
  \mu_{S, A}^* T(X)
  \ar[r]^{\eta_{S, A}^* \rho}
&
  (\alpha \cc \eta_{S, A})^* X
}
\]
and modified multiplication law
\[
\xymatrix@C+1em{
  T^2(X)
  \ar[r]^-{T(\rho)}
  \ar[d]^{\mu_{T, A}'}
&
  T(\alpha^* X) = \alpha^* T(X)
  \ar[r]^-{\alpha^* (\rho)}
&
  (S(\alpha) \cc \alpha)^* X
  \ar@{=}[d]
\\
  \mu_{S, A}^* T(X)
  \ar[rr]^-{\mu_{S, A}^* \rho}
&&
  (\alpha \cc \mu_{S, A})^* X
}
\]
over $A$ hold.

modified unit:
%  X --> T(X) over A --> S(A)
%  X --> (\eta_A^S)^* T(X) over A

modified multiplication:
%  T^2(X) -> T(X) over S^2(A) -> S(A)
%  T^*(X) -> (\mu_A^S)^* T(X) over S^2(A)

We define a functor $R$ from $Q^{-1}(A, \alpha)$ to $Q^{-1}(B, \beta)$ as follows.
Let $\rho : T(X) \to X$ be a $T$-algebra over $(A, \alpha)$.
Since $X : P^{-1}(A)$, we have $d_* X : P^{-1}(B)$.
Let us define a map $\sigma : T (d_* X) \to d_* X$ over $\beta$.
This is equivalent to defining $\sigma' : T (d_* X) \to \beta^* d_* X$.
By Beck-Chevalley, we have $\beta^* d_* \simeq S(d)_* \alpha^* X$ over $S(B)$.
So it is equivalent to defining $\sigma'' : T (d_* X) \to S(d)_* \alpha^* X$ over $S(B)$.
Using $S(d)^* \dashv S(d)_*$, it is equivalent to defining $\sigma''' : S(d)^* T(d_* X) \to \alpha^* X$ over $S(A)$.
This is the same as defining $\sigma'''' : S(d)^* T(d_* X) \to X$ over $\alpha$.
Using left composition with $\rho$, this follows from defining $\sigma''''' : S(d)^* T(d_* X) \to T(X)$ over $S(A)$.

%S(d)^* T(Y) --> T(d^* Y)

Let $\gamma : S(C) \to C$ be an $S$-algebra.
By assumption, we have cobase change functor $\gamma_! : P^{-1}(S(C)) \to P^{-1}(C)$.
The fiberwise functor $T : P^{-1}(C) \to P^{-1}(S(C))$ is not a monad on the fiber $P^{-1}(C)$, but we can rectify this deficit by instead working with $\gamma_! \cc T$, which has a monad structure induced by $T$.

We use it to define an endofunctor $M$ on $P^{-1}(C)$ as follows:
\[
\xymatrix{
  P^{-1}(C)
  \ar[r]^{T}
&
  P^{-1}(S(C))
  \ar[r]^{\gamma_!}
&
  P^{-1}(C)
}
\]
We can endow $M$ with a unit 
\end{comment}

\subsection{Application to (Right Parts of) Algebraic Weak Factorization Systems}

Let $\cat{E}$ be a locally cartesian-closed category.
We consider a codomain-preserving monad $R$ on $\cat{E}^{\to}$ (this is equivalent to the ``right part'' of an algebraic weak factorization system as explained in~\cite{garner:small-object-argument}).
This means that $R$ lies over the identity monad with respect to $\cod : \cat{E}^{\to} \to \cat{E}$.
We write $\Alg(R)$ for the category of algebras over $R$.
It comes with a strictly monadic functor $U : \Alg(R) \to \cat{E}^{\to}$.

\begin{corollary}
\label{Alg-over-cod-pres-monad-is-cartesian-fib}
The composition $\cod \cc U$ is a cartesian fibration.
\[
\xymatrix{
  \Alg(R)
  \ar[rr]^{U}
  \ar[dr]_{Q}
&&
  \cat{E}^{\to}
  \ar[dl]^{\cod}
\\&
  \cat{E}
}
\]
The functor $U$ creates cartesian lifts.
\end{corollary}

\begin{proof}
Apply \cref{Alg-preserves-cartesian-fib} to $R$ over $\Id_{\cat{E}}$ and note that $\Alg(\Id_{\cat{E}}) \simeq \cat{E}$.
\end{proof}

In particular, the action of base change for the cartesian fibration $\Alg(R) \to \cat{E}$ on the underlying map agrees with pullback; given a map $f : A \to B$ in the base $\cat{E}$, the corresponding base change functors as per the cleavage defined in \cref{Alg-preserves-cartesian-fib} commute strictly:
\[
\xymatrix{
  Q^{-1}(B)
  \ar[r]^{U}
  \ar[d]^{f^*}
&
  \cod^{-1}(B)
  \ar[d]^{f^*}
\\
  Q^{-1}(A)
  \ar[r]^{U}
&
  \cod^{-1}(A)
}
\]

\begin{corollary}
The cartesian fibration $Q$ in \cref{Alg-over-cod-pres-monad-is-cartesian-fib} has a right adjoint to base change along any map $f : A \to B$ in $\cat{E}$ such that $R$ preserves cartesian squares with bottom map $f$.
Furthermore, these right adjoints satisfy Beck-Chevalley with respect to pullback squares in the base.
\end{corollary}

\begin{proof}
Apply \cref{Alg-preserves-right-adjoint-to-base-change} and \cref{Alg-preserves-right-adjoint-to-base-change-BC} to $R$ over $\Id_{\cat{E}}$.
Note that structure maps of algebras over $\Id_{\cat{E}}$ are necessarily identities, hence the second and third conditions of \cref{Alg-preserves-right-adjoint-to-base-change} are vacuously satisfied.
\end{proof}

Note that this is analogous to the stable path objects condition of Warren, and also (by pullback pasting) the condition that left maps be preserved by pullback along right maps of Shulman, Joyal, and many others.

\section{Generalizing Filling to Composition}

\subsection{Filling}

For this section, fix a cocomplete category $\cat{E}$.
Recall from~\cite{garner:small-object-argument} that the Gallois connection $^{\pitchfork}(\arghole) \dashv (\arghole)^{\pitchfork}$ on the class of arrows of $\cat{E}$ may be lifted to an adjunction of categories over $\cat{E}^{\to}$:
\begin{equation}
\label{garner-adjunction}
\begin{gathered}
\xymatrix@C+1em{
  \CAT/\cat{E}^{\to}
  \ar@<5pt>[r]^{^{\pitchfork}(\arghole)}
  \ar@{}[r]|{\bot}
&
  (\CAT/\cat{E}^{\to})^{\op}
  \ar@<5pt>[l]^{(\arghole)^{\pitchfork}}
}
\end{gathered}
\end{equation}
The following duality lemma also carries over from the non-algebraic setting:

\begin{lemma}
\label{lift-of-adjunction}
Consider an adjunction as follows:
\[
\xymatrix@C+1em{
  \cat{D}
  \ar@<5pt>[r]^{L}
  \ar@{}[r]|{\bot}
&
  \cat{E}
  \ar@<5pt>[l]^{R}
}
\]
Let $U : \cat{A} \to \cat{D}^{\to}$ and $V : \cat{B} \to \cat{E}^{\to}$ be categories over $\cat{D}^{\to}$ and $\cat{E}^{\to}$, respectively.
Lifts of $L^{\to}$ to a functor $\cat{A} \to {}^\pitchfork\cat{B}$ are in natural correspondence with lifts of $R^{\to}$ to a functor $\cat{B} \to \cat{A}^{\pitchfork}$:
\begin{mathpar}
\xymatrix{
  \cat{A}
  \ar@{.>}[r]
  \ar[d]_{U}
&
  ^{\pitchfork}\cat{B}
  \ar[d]^{^{\pitchfork}V}
\\
  \cat{D}^{\to}
  \ar[r]^{L^{\to}}
&
  \cat{E}^{\to}
}
\and
\xymatrix{
  \cat{A}^{\pitchfork}
  \ar[d]_{U^{\pitchfork}}
&
  \cat{B}
  \ar@{.>}[l]
  \ar[d]^{V}
\\
  \cat{D}^{\to}
&
  \cat{E}^{\to}
  \ar[l]^{R^{\to}}
}
\end{mathpar}
\end{lemma}

\begin{proof}
Maps from $L^{\to} \cc U$ to $^{\pitchfork}V$ over $\cat{E}^{\to}$ consist of fillers for squares $L^{\to}(U(X)) \to V(Y)$ natural in $X : \cat{A}$ and $Y : \cat{B}$.
Similarly, maps from $R^{\to} \cc V$ to $U^{\pitchfork}$ over $\cat{D}^{\to}$ consist of fillers for squares $U(X) \to R^{\to}(V(Y))$ natural in $X : \cat{A}$ and $Y : \cat{B}$.
Since $L \dashv R$, these situations coincide.
\end{proof}

\subsection{Slicing for filling}

Let $X$ be an object of $\cat{E}$.
Given a category $U : \cat{A} \to \cat{E}^{\to}$ over $\cat{E}^{\to}$, we may pull it back to a category $\Slice_X(U) : \Slice_X(\cat{A}) \to (\cat{E}/X)^{\to}$ over $(\cat{E}/X)^{\to}$:
\[
\xymatrix{
  \Slice_X(\cat{A})
  \ar[r]
  \ar[d]_{\Slice_X(U)}
  \pullback{dr}
&
  \cat{A}
  \ar[d]^{U}
\\
  (\cat{E}/X)^{\to}
  \ar[r]^{p_!^{\to}}
&
  \cat{E}^{\to}
}
\]
Explicitly, the category $\Slice_X(\cat{A})$ consists of pairs $(Y, h)$ where $Y : \cat{A}$ and $h$ is a map in $\cat{E}$ from the codomain of $U(Y)$ to $X$.
We call this operation \emph{slicing} along $X$.
Dually, pulling back along $(\cat{E} \backslash X)^{\to} \to \cat{E}^{\to}$ gives us a \emph{coslicing} operation along $X$.

\begin{lemma}
\label{pitchfork-slicing}
The functor $(\arghole)^{\pitchfork}$ and $^{\pitchfork}(\arghole)$ commute (up to natural isomorphism) with slicing and coslicing, respectively.
\end{lemma}

\begin{proof}
Easy to see.
\end{proof}

\subsection{Retract closure for filling}

Let $U : \cat{A} \to \cat{E}^{\to}$ be a category over $\cat{E}^{\to}$.
We define its retract-closure $\overline{U} : \overline{\cat{A}} \to \cat{E}^{\to}$ as follows.
An object of $\overline{\cat{A}}$ consists of $a : \cat{A}$ and a retract of $U(a)$ in $\cat{E}^{\to}$, \ie an object $e : \cat{E}^{\to}$ together with maps $s : e \to U(a)$ and $r : U(a) \to e$ such that $r \cc s = \id_e$:
\[
\xymatrix{
  e
  \ar[r]_{s}
  \ar@/^1em/[rr]^{\id}
&
  U(a)
  \ar[r]_{r}
&
  e
}
\]
The action of $\overline{U}$ on this object is $\overline{U}(a, e, s, t) = e$.
A morphism between such objects $(a, e, s, t)$ and $(a', e', s', t')$ consists of a morphism $f : a \to a'$ in $\cat{A}$ and a morphism $h : e \to e'$ in $\cat{E}^{\to}$ such that the evident squares commute:
\[
\xymatrix{
  e
  \ar[r]_{s}
  \ar@/^1em/[rr]^{\id}
  \ar[d]_{h}
&
  U(a)
  \ar[r]_{r}
  \ar[d]^{U(f)}
&
  e
  \ar[d]^{h}
\\
  e'
  \ar[r]^{s'}
  \ar@/_1em/[rr]_{\id}
&
  U(a')
  \ar[r]^{r'}
&
  e'
}
\]
The action of $\overline{U}$ on this morphism is $\overline{U}(f, h) = h$.

We have an evident inclusion $\cat{A} \to \overline{\cat{A}}$ of categories over $\cat{E}^{\to}$ mapping $a$ to $(a, U(a), \id_{U(a)}, \id_{U(a)})$.

\begin{lemma}
\label{retract-closure}
Recall the adjunction~\eqref{garner-adjunction}.
The inclusion $\overline{\cat{A}} \to \cat{A}$ induces functors $^{\pitchfork}\overline{\cat{A}} \to{} ^{\pitchfork}\cat{A}$ and $\overline{\cat{A}}^{\pitchfork} \to \cat{A}^{\pitchfork}$ of categories over $\cat{E}^{\to}$.
These functors are isomorphisms.
\end{lemma}

\begin{proof}
Easy to check by purely formal reasoning.
\end{proof}

\subsection{Dependent product for filling}

\begin{corollary}
\label{lift-dependent-product}
Let $p : Y \to X$ be a map in $\cat{E}$ admitting pullback and pushforward:
\[
\xymatrix@C+1em{
  \cat{E}/X
  \ar@<5pt>[r]^{p^*}
  \ar@{}[r]|{\bot}
&
  \cat{E}/Y
  \ar@<5pt>[l]^{p_*}
}
\]
Let $W : \cat{C} \to \cat{E}^{\to}$ be a category over $\cat{E}^{\to}$.
Then lifts of pushforward
\[
\xymatrix{
  \Slice_X(\cat{C}^{\pitchfork})
  \ar@{.>}[r]
  \ar[d]_{\Slice_X(W)}
&
  \Slice_Y(\cat{C}^{\pitchfork})
  \ar[d]^{\Slice_Y(U^{\pitchfork})}
\\
  (\cat{E}/X)^{\to}
&
  (\cat{E}/Y)^{\to}
  \ar[l]^{(p_*)^{\to}}
}
\]
are in natural correspondence with lifts of pullback
\[
\xymatrix{
  \Slice_X(\cat{C})
  \ar@{.>}[r]
  \ar[d]_{\Slice_X(W)}
&
  {}^{\pitchfork}(\Slice_Y(\cat{C}^{\pitchfork}))
  \ar[d]^{^{\pitchfork}\Slice_Y(U^{\pitchfork})}
\\
  (\cat{E}/X)^{\to}
  \ar[r]^{(p^*)^{\to}}
&
  (\cat{E}/Y)^{\to},
}
\]
which in turn correspond to maps from $\Slice_Y(W)^{\pitchfork}$ to $((p^*)^{\to} \cc \Slice_Y(W))^{\pitchfork}$ over $(\cat{E}/Y)^{\to}$.
\end{corollary}

\begin{proof}
Recall from \cref{pitchfork-slicing} that slicing commutes with $(\arghole)^{\pitchfork}$.
For the first correspondence, apply \cref{lift-of-adjunction} to the adjunction $p^* \dashv p_*$ with $U = W$ and $V = W^{\pitchfork}$.
The last statement is simply the adjunction~\eqref{garner-adjunction}.
\end{proof}

\subsection{Composition}

Recall the arrow category $\cat{E}^{\to}$.
The \emph{square category} $\cat{E}^{\Box}$ is the double arrow category $(\cat{E}^{\to})^{\to}$.
We have evident inclusions $\squl, \squr, \sqdl, \sqdr$ of the walking object and $\sql, \sqr, \squ, \sqd$ of the walking arrow into the walking square:
\[
\xymatrix{
  \squl
  \ar[r]^{\squ}
  \ar[d]_{\sql}
  \ar@{}[dr]
&
  \squr
  \ar[d]^{\sqr}
\\
  \sqdl
  \ar[r]_{\sqd}
&
  \sqdr
}
\]
We also have projections $\sqhori$ and $\sqvert$ from the walking square to the walking arrow that are sections to $\sql, \sqr$ and $\squ, \sqd$, respectively.

Given a square $X : \cat{E}^{\Box}$, its corners and sides are thus given by functor precomposition as $X\squl, X\squr, X\sqdl, X\sqdr : \cat{E}$ and $X\sql, X\sqr, X\squ, X\sqd : \cat{E}^{\to}$, respectively.
Similarly, given a line $f : \cat{E}^{\to}$, then $f\sqhori$ and $f\sqvert$ are the squares that have identities as horizontal and vertical sides, respectively, with the other sides being given by $f$.
Note that if $h : X \to Y$ is a morphism of squares, then \eg $h\sql : X\sql \to Y\sql$ will denote the induced morphism between the left sides, and analogously for the other operations as indicated by the suggestive functor precomposition notation.

Given a square $X : \cat{E}^{\Box}$, we will sometimes equivalently view it as a morphism in $\cat{E}^{\to}$ from $X\sql$ to $X\sqr$.

Recall from~\cite{garner:small-object-argument} that the Gallois connection $^{\pitchfork}(\arghole) \dashv (\arghole)^{\pitchfork}$ on the class of arrows of $\cat{E}$ may be lifted to an adjunction of categories over $\cat{E}^{\to}$:
\begin{equation}
\label{garner-adjunction}
\begin{gathered}
\xymatrix@C+1em{
  \CAT/\cat{E}^{\to}
  \ar@<5pt>[r]^{^{\pitchfork}(\arghole)}
  \ar@{}[r]|{\bot}
&
  (\CAT/\cat{E}^{\to})^{\op}
  \ar@<5pt>[l]^{(\arghole)^{\pitchfork}}
}
\end{gathered}
\end{equation}

\begin{lemma}
\label{garner-adjunction-extended}
The adjunction~\eqref{garner-adjunction} can be lifted further to an adjunction as follows:
\begin{equation}
\label{garner-adjunction-extended}
\begin{gathered}
\xymatrix@C+1em{
  \CAT/\cat{E}^{\Box}
  \ar@<5pt>[r]^{^{\pitchfork}(\arghole)}
  \ar@{}[r]|{\bot}
&
  (\CAT/\cat{E}^{\Box})^{\op}
  \ar@<5pt>[l]^{(\arghole)^{\pitchfork}}
}
\end{gathered}
\end{equation}
\end{lemma}

\begin{proof}[Proof (adapted from \cite{garner:small-object-argument})]
Let us first define the functor $(\arghole)^{\pitchfork}$.
It sends $U : \cat{A} \to \cat{E}^{\Box}$ to the category $\cat{A}^{\pitchfork}$ that has as objects pairs $(T, \phi)$ consisting of a square $T : \cat{E}^{\Box}$ with a coherent choice $\phi$ of \emph{compositions}.
For $X : A$ and a ``middle square'' $M : U(X)\sqr \to T\sql$, a composition $\phi(A, M)$ is a lift in the composite square indicated below:
\[
\xymatrix{
  \bullet
  \ar[r]
  \ar[d]
  \ar@{}[dr]|(0.4){U(X)}
&
  \bullet
  \ar[r]
  \ar[d]
  \ar@{}[dr]|(0.3){M}
&
  \bullet
  \ar[r]
  \ar[d]
  \ar@{}[dr]|(0.6){T}
&
  \bullet
  \ar[d]
\\
  \bullet
  \ar[r]
  \ar@{.>}[urrr]
&
  \bullet
  \ar[r]
&
  \bullet
  \ar[r]
&
  \bullet
}
\]
Coherence of composition means that for a morphism $f : X \to X'$ in $\cat{A}$ and a square $M' : U(X)\sqr \to T\sql$, we have $\phi(X, M \cc U(f)\sqr) = \phi(X', M') \cc U(f)\sqdl$.
A morphism in $\cat{A}^{\pitchfork}$ from $(T, \phi)$ to $(T', \phi')$ is a morphism $t : T \to T'$ of squares respecting the choice of liftings $\phi$ and $\phi'$: for $X : A$ and $M : U(X)\sqr \to T$, we must have $t\squr \cc \phi(X, M) = \phi'(X, t\sql \cc M)$.
We have an evident forgetful functor from $\cat{A}^{\pitchfork} \to \cat{E}^{\Box}$.

This concludes the construction of the action of $(\arghole)^{\pitchfork}$ on objects.
The action on a morphism $F : \cat{A} \to \cat{B}$ is given by the functor $\cat{B}^{\pitchfork} \to \cat{A}^{\pitchfork}$ over $\cat{E}^{\Box}$ sending $(T, \psi)$ to $(T, \phi)$ where $\phi(X, M) = \psi(F(X), M)$.

The functor $^{\pitchfork}(\arghole)$ is defined analogously, but with directions and order of composition swapped.
To see that $^\pitchfork(\arghole) \pitchfork (\arghole)^{\pitchfork}$, note that given categories $U : \cat{A} \to \cat{E}^{\Box}$ and $V : \cat{B} \to \cat{E}^{\Box}$ over $\cat{E}^{\Box}$, both functors $\cat{A} \to {}^{\pitchfork}\cat{B}$ and $\cat{B} \to \cat{A}^{\pitchfork}$ may be identified with ``$(\cat{A}, \cat{B})$-lifting operations'': a function $\psi$ that assigns to objects $X : \cat{A}$ and $Y : \cat{B}$ and a ``middle square'' $M : U(X)\sqr \to V(Y)\sql$ a lift for the composite square 
\[
\xymatrix{
  \bullet
  \ar[r]
  \ar[d]
  \ar@{}[dr]|(0.4){U(X)}
&
  \bullet
  \ar[r]
  \ar[d]
  \ar@{}[dr]|(0.3){M}
&
  \bullet
  \ar[r]
  \ar[d]
  \ar@{}[dr]|(0.6){V(Y)}
&
  \bullet
  \ar[d]
\\
  \bullet
  \ar[r]
  \ar@{.>}[urrr]
&
  \bullet
  \ar[r]
&
  \bullet
  \ar[r]
&
  \bullet
}
\]
that is natural in the evident manner in both $X$ and $Y$.
\end{proof}

\begin{remark}
\label{extended-adjunction-gives-normal-one}
Recall the inclusion $E\sqhori : \cat{E}^{\to} \to \cat{E}^{\Box}$ that sends a line $f$ to the square with left and right sides $f$ and up and bottom sides identities.
It related categories over $\cat{E}^{\Box}$ and $\cat{E}^{\to}$ by an adjunction:
\begin{equation}
\label{adjunction-between-E-square-and-E-to}
\begin{gathered}
\xymatrix@C+1em{
  \CAT/\cat{E}^{\Box}
  \ar@<5pt>[r]^{E\sqhori_!}
  \ar@{}[r]|{\bot}
&
  \CAT/\cat{E}^{\to}
  \ar@<5pt>[l]^{(E\sqhori)^*}
}
\end{gathered}
\end{equation}
In fact, as can be confirmed from inspection of the constructions, the adjunction~\eqref{garner-adjunction} arises from the extended adjunction~\eqref{garner-adjunction-extended} by pre- and postcomposition with the adjunction~\eqref{adjunction-between-E-square-and-E-to} and its opposite:
\begin{equation*}
\begin{gathered}
\xymatrix@R+1em@C+1em{
  \CAT/\cat{E}^{\to}
  \ar@<5pt>[r]^{^{\pitchfork}(\arghole)}
  \ar@{}[r]|{\bot}
  \ar@<5pt>[d]^{(E\sqhori)^*}
  \ar@{}[d]|{\dashv}
&
  (\CAT/\cat{E}^{\to})^{\op}
  \ar@<5pt>[l]^{(\arghole)^{\pitchfork}}
  \ar@<5pt>[d]^{((E\sqhori)^*)^{\op}}
  \ar@{}[d]|{\vdash}
\\
  \CAT/\cat{E}^{\Box}
  \ar@<5pt>[r]^{^{\pitchfork}(\arghole)}
  \ar@{}[r]|{\bot}
  \ar@<5pt>[u]^{E\sqhori_!}
&
  (\CAT/\cat{E}^{\Box})^{\op}
  \ar@<5pt>[l]^{(\arghole)^{\pitchfork}}
  \ar@<5pt>[u]^{(E\sqhori_!)^{\op}}
}
\end{gathered}
\end{equation*}
If we only choose to either pre- or postcompose, we end up with ``mixed'' versions of the adjunction that we are still going to denote using the same symbols:
\begin{equation}
\label{garner-adjunction-extended-mixed}
\begin{gathered}
\xymatrix@C+1em{
  \CAT/\cat{E}^{\Box}
  \ar@<5pt>[r]^{^{\pitchfork}(\arghole)}
  \ar@{}[r]|{\bot}
&
  (\CAT/\cat{E}^{\to})^{\op}
  \ar@<5pt>[l]^{(\arghole)^{\pitchfork}}
}
\end{gathered}
\end{equation}
or:
\begin{equation}
\label{garner-adjunction-extended-mixed'}
\begin{gathered}
\xymatrix@C+1em{
  \CAT/\cat{E}^{\to}
  \ar@<5pt>[r]^{^{\pitchfork}(\arghole)}
  \ar@{}[r]|{\bot}
&
  (\CAT/\cat{E}^{\Box})^{\op}
  \ar@<5pt>[l]^{(\arghole)^{\pitchfork}}
}
\end{gathered}
\end{equation}
\end{remark}

We have a straightforward analogue of \cref{lift-of-adjunction}:

\begin{lemma}
\label{lift-of-adjunction}
Consider an adjunction as follows:
\[
\xymatrix@C+1em{
  \cat{D}
  \ar@<5pt>[r]^{L}
  \ar@{}[r]|{\bot}
&
  \cat{E}
  \ar@<5pt>[l]^{R}
}
\]
Let $U : \cat{A} \to \cat{D}^{\Box}$ and $V : \cat{B} \to \cat{E}^{\Box}$ be categories over $\cat{D}^{\Box}$ and $\cat{E}^{\Box}$, respectively.
Lifts of $L^{\Box}$ to a functor $\cat{A} \to {}^\pitchfork\cat{B}$ are in natural correspondence with lifts of $R^{\Box}$ to a functor $\cat{B} \to \cat{A}^{\pitchfork}$:
\begin{mathpar}
\xymatrix{
  \cat{A}
  \ar@{.>}[r]
  \ar[d]_{U}
&
  ^{\pitchfork}\cat{B}
  \ar[d]^{^{\pitchfork}V}
\\
  \cat{D}^{\Box}
  \ar[r]^{L^{\Box}}
&
  \cat{E}^{\Box}
}
\and
\xymatrix{
  \cat{A}^{\pitchfork}
  \ar[d]_{U^{\pitchfork}}
&
  \cat{B}
  \ar@{.>}[l]
  \ar[d]^{V}
\\
  \cat{D}^{\Box}
&
  \cat{E}^{\Box}
  \ar[l]^{R^{\Box}}
}
\end{mathpar}
\end{lemma}

\begin{proof}
Maps from $L^{\Box} \cc U$ to $^{\pitchfork}V$ over $\cat{E}^{\Box}$ consist of composition for squares $L^{\Box}(U(X))\sqr \to V(Y)\sql$ natural in $X : \cat{A}$ and $Y : \cat{B}$.
Similarly, maps from $R^{\Box} \cc V$ to $U^{\pitchfork}$ over $\cat{D}^{\Box}$ consist of composition for squares $U(X)\sqr \to R^{\Box}(V(Y))\sql$ natural in $X : \cat{A}$ and $Y : \cat{B}$.
Since $L \dashv R$, these situations coincide.
\end{proof}

\subsection{Slicing for composition}

Let $X$ be an object of $\cat{E}$.
Given a category $U : \cat{A} \to \cat{E}^{\Box}$ over $\cat{E}^{\Box}$, we may pull it back to a category $\Slice_X(U) : \Slice_X(\cat{A}) \to (\cat{E}/X)^{\Box}$ over $(\cat{E}/X)^{\Box}$:
\[
\xymatrix{
  \Slice_X(\cat{A})
  \ar[r]
  \ar[d]_{\Slice_X(U)}
  \pullback{dr}
&
  \cat{A}
  \ar[d]^{U}
\\
  (\cat{E}/X)^{\Box}
  \ar[r]^{p_!^{\Box}}
&
  \cat{E}^{\Box}
}
\]
Explicitly, the category $\Slice_X(\cat{A})$ consists of pairs $(Y, h)$ where $Y : \cat{A}$ and $h$ is a map in $\cat{E}$ from $U(Y)\sqdr$ to $X$.
We call this operation \emph{slicing} along $X$.
Dually, pulling back along $(\cat{E} \backslash X)^{\Box} \to \cat{E}^{\Box}$ gives us a \emph{coslicing} operation along $X$.

\begin{lemma}
\label{pitchfork-slicing-composition}
The functor $(\arghole)^{\pitchfork}$ and $^{\pitchfork}(\arghole)$ commute (up to natural isomorphism) with slicing and coslicing, respectively.
\end{lemma}

\begin{proof}
Easy to see.
\end{proof}

\subsection{Dependent product for composition}

We have straightforward analogues of \cref{lift-dependent-product} for the four variations of the pitchfork adjunction with arrows or boxes on the left or the right side.
For our purposes, the basic filling variant will suffice, so we will not make the other variants explicit.

\subsection{Retract closure for composition}

We are now going to define the analogue of retract closure for composition.

Let $U : \cat{A} \to \cat{E}^{\Box}$ be a category over $\cat{E}^{\Box}$.
We define its left retract-closure $\overline{U}_L : \overline{\cat{A}}_L \to \cat{E}^{\Box}$ as follows.
An object of $\overline{\cat{A}}_L$ is a tuple $(a, e, s, r)$ with $a : \cat{A}$ and $e : \cat{E}^{\Box}$ together with morphisms $s : U(a)\sql \to e\sql$ and $r : e\sqr \to U(a)\sqr$ such that $r \cc U(a) \cc s = e$ where we $U(a)$ and $e$ as morphisms in $\cat{E}^{\to}$:
\[
\xymatrix{
  e\sql
  \ar[r]^{e}
  \ar[d]^{s}
  \ar@/_2em/[dd]_{\id}
&
  e\sqr
  \ar@/^2em/[dd]^{\id}
\\
  U(a)\sql
  \ar[r]^{U(a)}
&
  U(a)\sqr
  \ar[d]_{t}
\\
  e\sql
  \ar[r]^{e}
&
  e\sqr
}
\]
The action of $\overline{U}_L$ on this object is $\overline{U}_L(a, e, s, t) = e$.
A morphism between such objects $(a, e, s, t)$ and $(a', e', s', t')$ consists of a morphism $f : a \to a'$ in $\cat{A}$ and a morphism $h : e \to e'$ in $\cat{E}^{\Box}$ such that the evident squares commute:
\[
\xymatrix{
  e
  \ar[r]_{s}
  \ar@/^1em/[rr]^{\id}
  \ar[d]_{h}
&
  U(a)
  \ar[r]_{r}
  \ar[d]^{U(f)}
&
  e
  \ar[d]^{h}
\\
  e'
  \ar[r]^{s'}
  \ar@/_1em/[rr]_{\id}
&
  U(a')
  \ar[r]^{r'}
&
  e'
}
\]
The action of $\overline{U}_L$ on this morphism is $\overline{U}_L(f, h) = h$.

We have an evident inclusion $\cat{A} \to \overline{\cat{A}}_L$ of categories over $\cat{E}^{\Box}$ mapping $a$ to $(a, U(a), \id_{U(a)\sql}, \id_{U(a)\sqr})$.

\begin{lemma}
\label{retract-closure-extended-left}
Recall the adjunction~\eqref{garner-adjunction-extended}.
The inclusion $\cat{A} \to \overline{\cat{A}}_L$ induces a functor $\overline{\cat{A}}_L^{\pitchfork} \to \cat{A}^{\pitchfork}$ of categories over $\cat{E}^{\Box}$.
This functor is an isomorphisms.
\end{lemma}

\begin{proof}
Easy to check by purely formal reasoning.
\end{proof}

\begin{remark}
\label{retract-closure-extended-right}
We have a dual construction $\overline{U}_R : \overline{\cat{A}}_R \to \cat{E}^{\Box}$ with an inclusion $\cat{A} \to \overline{\cat{A}}_R$ of categories over $\cat{E}^{\Box}$.
Analogously to \cref{retract-closure-extended-left}, the induced functor $^{\pitchfork}\overline{\cat{A}}_L \to{} ^{\pitchfork}\cat{A}$ of categories over $\cat{E}^{\Box}$ is an isomorphism.
\end{remark}

\subsection{Application}

[$\ldots$]

%We now restrict our attention to simplicial sets.
%Let $U : \cat{I} \to \cat{E}^{\to}$ be (decidable) subobjects of representables.
%Let $V = (h_1^1 \hattimes \arghole) \cc U : \cat{I} \to \cat{E}^{\to}$ and $W = (\theta \hattimes \arghole) \cc U : \cat{I} \to \cat{E}^{\Box}$.
%Note that $V = \arghole\sqr \cc W$.
%This gives a map from $W$ to $\cat{E}\sqhori \cc V$ over $\cat{E}^{\Box}$. 

%For the rest of this section, we will only use version~\eqref{garner-adjunction-extended-mixed} of the adjunctions.
\bibliographystyle{plain}
\bibliography{../../common/uniform-kan-bibliography}

\end{document}